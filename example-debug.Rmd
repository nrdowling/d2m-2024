---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
    role: # Contributorship roles (e.g., CRediT, https://credit.niso.org/)
      - "Conceptualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"
    role:
      - "Writing - Review & Editing"
      - "Supervision"

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  One or two sentences to put the results into a more **general context**.
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : "r-references.bib"

floatsintext      : yes
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library(papaja)
library(tidyverse)
library(kableExtra)
r_refs("r-references.bib")
mydata <- as_tibble(mtcars, rownames = "model")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```



## Tables

Knitting R documents can render tables in several different forms. To start, you have your basic "console style." This is more or less what you'd see in the console you just ran the table (or called the object) in an R script or directly in the console.

```{r table-avgmpg-consolestyle}
mydata %>%
  group_by(cyl) %>%
  summarize(
    mean.mpg = mean(mpg),
    sd.mpg = sd(mpg),
    n.models = n()
  )
```

The `knitr` package contains the `kable()` function. Passing a dataframe into this function will produce a formatted table that's already pretty nice looking without needing additional modification. When you run the code chunk in R Studio, it is clearly different from the console version, but it's not exactly beautiful. However, that output that appears beneath your code chunk isn't the same as what you'll see when you actually knit it.

You don't need to do anything more than pipe the df to `kable()` to get this formatted table, but we can add optional arguments like `caption`. 

```{r table-avgmpg-kablestyle}
mydata %>%
  group_by(cyl) %>%
  summarize(
    mean.mpg = mean(mpg),
    sd.mpg = sd(mpg),
    n.models = n()
  ) %>%
  knitr::kable(caption = "mpg stats by number of cylinders")
```

From there we can add in many additional arguments to tweak the visuals of this already decently formatted table exactly to our preferences. Alternatively, we can use "wrapper" functions that add in a collection of tweaks for us, like the `apa_table()` function in `papaja`, which will knit the table in APA formatting.

In this example, rather than piping the df into the function (which we could have done), the df is saved as an object that is then used as the `data` argument. Because `apa_table()` is a wrapper, we can still use the same arguments with the basic `kable()` function, like `caption`.

Some wrapper functions, including `apa_table()`, rely on LaTeX formatting that can't render in R Studio. When you run the chunk in your R notebook, you'll just see a blank box. The APA formatted table will render in your Word or PDF document. Note that not all wrapper functions will have this "blank box problem." Other wrappers will not only not show up in R Studio, but will only render in either Word *or* PDF format.

```{r table-avgmpg-apastyle, results = 'asis'}
mytable <- mydata %>%
  group_by(cyl) %>%
  summarize(
    mean.mpg = mean(mpg),
    sd.mpg = sd(mpg),
    n.models = n()
  )

apa_table(mytable, caption = "mpg stats by number of cylinders")
```


Back to the basic kable, there is nearly unlimited customization you can employ, especially if you use the [`kableExtra`](https://haozhu233.github.io/kableExtra/) package (which is exactly what it sounds like). Here are a handful of modifications I think you're most likely to want to know about:

  1. Add a caption
  2. Change column names
  3. Specify column alignment
  4. Format columns
  5. Style table size and position
  6. Make row- and column-specific tweaks
  7. Group rows, columns, and cells
  8. Add table (foot)notes

Many of the examples below are taken or adapted from the [R Markdown Cookbook](https://bookdown.org/yihui/rmarkdown-cookbook/tables.html).

Tables\ \@ref(tab:table-column-names-alignment1) and\ \@ref(tab:table-column-names-alignment2) modify column names and alignment identically but with slightly different syntax and add captions to describe each.

```{r table-column-names-alignment1}

kable(iris, 
      col.names = c("Sepal Length",	"Sepal Width",	"Petal Length",	"Petal Width",	"Species"), 
      align = c("l", "r", "l", "r", "c"),
      caption = "Change each column name and text alignments, each with a list of strings.")

```

```{r table-column-names-alignment2}

kable(iris, 
      col.names = gsub("[.]", " ", names(iris)), 
      align = "lrlrc",
      caption = "Use 'gsub' function to replace periods with spaces and change text alignments with a single 'shortcut' string.")


```

Tables\ \@ref(tab:table-column-formats1), \ \@ref(tab:table-column-formats2), and\ \@ref(tab:\ \@ref(tab:table-column-formats3) specify format of numeric columns:

```{r table-column-formats1}

d <- cbind(
  X1 = runif(3), 
  X2 = 10^c(3, 5, 7), 
  X3 = rnorm(3, 0, 1000))

kable(d, digits = 4,
      caption = "All numeric data in all columns display at most 4 decimal places")

```

```{r table-column-formats2}

kable(d, digits = c(5, 0, 2),
      caption = "Round columns to 5, 0, and 2 digits (respectively).")

```

```{r table-column-formats3}


kable(d, digits = 3, 
      format.args = list(big.mark = ",", # Use US notation of including a comma (vs period) every three digits
                         scientific = FALSE),
      caption = "Round all data to max 3 decimal places and do not use scientific notaiton.")

```



For the second half of the list (5-8), we need the `kableExtra` package. Most things that this package can do will work in both Word and PDF outputs, but Word does not support LaTeX formatting. As a result, the results are pretty iffy. Sticking with PDF output format is recommended. If you need to knit to a Word doc, refer to the package documentation for suggestions on how to do so.

This package includes the `kbl()` function, which is *identical* to `kable()`. If you have `kableExtra` loaded you can use either, but the advantage of using `kbl()` is that it will throw an obvious error if you don't have the package loaded, which you might not notice otherwise.

To use styling functions in the `kableExtra` package, you'll create a kable with `kable()` or `kbl()` and pipe (`%>%`) it into the style function. Examples in this section come from the `kableExtra` package [documentation](https://haozhu233.github.io/kableExtra/).

```{r load-kableExtra}

library(kableExtra)
dt <- mtcars[1:5, 1:6]

```

By default, knitr will place tables wherever it thinks the best place in your document for that table will be. This is often great, but sometimes it's a very bad guesser. It will also guess the size/scale your table should be. You can control these things yourself.

In Table\ \@ref(tab:table-hold-position), the `hold_position` style option "pins" the table where you call it. Most examples from here on will include this argument.


```{r table-hold-position, results='asis'}

## except this doesn't always work with papaja!! :(

kbl(dt, 
    caption = "Table will appear exactly where you call it."
    ) %>%
  kable_styling(latex_options = "hold_position")

```

Table\ \@ref(tab:table-size-scaledown), shows the use of the `scale_down` option (with `hold_position`) to scale a wide table down to fit on the page. This can be used instead of or in addition to printing the table in landscape page format. See the `kableExtra` docs for how to do that.

```{r table-size-scaledown, results='asis'}

kbl(cbind(dt, dt, dt), # create a very wide table
    caption = "When you have a wide table that will normally go out of the page, and you want to scale down the table to fit the page, you can use the scale down option.") %>%
  #kable_styling(latex_options = c("striped", "scale_down", "hold_position"))
  kable_styling(latex_options = c("scale_down", "hold_position"))

```



You can also scale *up* a table to make a small/narrow table full width with either the `scale_up` option (Table\ \@ref(tab:table-size-scaleup)) or `full_width` argument (Table\ \@ref(tab:table-size-fullwidth)).

```{r table-size-scaleup, results='asis'}

kbl(cbind(dt),
    caption = "Use the scale up option to stretch to full page width.") %>%
  kable_styling(latex_options = "scale_up")
```

```{r table-size-fullwidth, results='asis'}

kbl(dt, 
    caption = "Stretch a small table to fit the page with the full width option.") %>%
  kable_styling(full_width = T)

```


When you have very long tables that would extend over multiple pages, use the `longtable` argument, usually in combination with the `repeat_header` option (Table\ \@ref(tab:table-size-longtable)).

```{r table-size-longtable, eval=FALSE, include=FALSE, results='asis'}

long_dt <- rbind(mtcars, mtcars) # create a very long table

kbl(long_dt, 
    longtable = T, 
    caption = "Use the longtable argument in to intelligently manage very long tables. Use the repeat header LaTeX option") #%>%
 # add_header_above(c(" ", "Group 1" = 5, "Group 2" = 6)) %>%
  #table_styling(latex_options = "repeat_header")

```


By default, tables are aligned center on the page, but they can also be aligned left or right. Note that alignment does not apply to full width tables. Table\ \@ref(tab:table-alignleft) uses the `position = "left" argument` to align left. Oddly, aligning right in the same way doesn't work as expected. In theory you can "float right" rather than position right, but this can produce errors. It's unlikely you'll need to right align a table though.

```{r table-alignleft, results='asis'}

kbl(dt, 
    caption = "Align your table (not the text, the whole table), 'left' or 'center' (the default) with the position argument.") %>% 
  kable_styling(position = "left")
```


